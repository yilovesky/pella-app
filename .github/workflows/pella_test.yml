name: Pella Login RENEW

on:
  workflow_dispatch: # 手动触发测试
  schedule:
    - cron: '0 0 * * *' # 每隔24小时启动一次（UTC时间每天00:00）

jobs:
  test-pella:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'

      - name: Install Dependencies
        run: |
          pip install seleniumbase loguru requests
          sbase install chromedriver

      - name: Run Pella Test
        env:
          PELLA_EMAIL: ${{ secrets.PELLA_EMAIL }}
          GMAIL_APP_PASSWORD: ${{ secrets.GMAIL_APP_PASSWORD }}
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: python pella_test.py

      - name: Upload Screenshots
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: pella-screenshots
          # 核心修改：使用通配符抓取所有生成的图片
          path: |
            *.png
          # 如果没有发现文件，仅发出警告而不报错
          if-no-files-found: warn
